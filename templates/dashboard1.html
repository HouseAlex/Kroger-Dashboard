{% extends 'base.html' %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div>
    
       <!--     
            {% for row in data %}
            <tr>
                <td>{{ row.HSHD_NUM }}</td>
                <td>{{ row.BASKET_NUM }}</td>
                <td>{{ row.DATE }}</td>
                <td>{{ row.PRODUCT_NUM }}</td>
                <td>{{ row.DEPARTMENT }}</td>
                <td>{{ row.COMMODITY }}</td>
                <td>{{ row.SPEND }}</td>
                <td>{{ row.UNITS }}</td>
                <td>{{ row.STORE_R }}</td>
                <td>{{ row.WEEK_NUM }}</td>
                <td>{{ row.YEAR }}</td>
                <td>{{ row.L }}</td>
                <td>{{ row.AGE_RANGE }}</td>
                <td>{{ row.MARITAL }}</td>
                <td>{{ row.INCOME_RANGE }}</td>
                <td>{{ row.HOMEOWNER }}</td>
                <td>{{ row.HSHD_COMPOSITION }}</td>
                <td>{{ row.HH_SIZE }}</td>
                <td>{{ row.CHILDREN }}</td>
            </tr>
            {% endfor %}
        </table> -->

    <div id="dashboard-container"class="container">
        <div class="row">
            <select id="demographicDDL">
                <option value="AGE_RANGE">Age Range</option>
                <option value="MARITAL">Marital Status</option>
                <option value="INCOME_RANGE">Income Range</option>
                <option value="HOMEOWNER">Homeowner Status</option>
                <option value="CHILDREN">Number of Children</option>
            </select>
        </div>
        <div class="row">
            <div id='totalTransactionBar' class='chart g-col-6' style="width: 600px;">
                <script type='text/javascript'>
                    var graphs = {{totalTransactionBar | safe}};
                    Plotly.plot('totalTransactionBar',graphs,{});
                </script>
            </div>
            <div id='totalSpentBar' class='chart g-col-6'style="width: 600px;">
                <script type='text/javascript'>
                    var pie = {{totalSpentBar | safe}};
                    Plotly.plot('totalSpentBar',pie,{});
                </script>
            </div>
        </div>
        
        <div class="row">
            <div id='averageSpendPie' class='chart g-col-6'style="width: 600px;">
                <script type='text/javascript'>
                    var pie = {{averageSpendPie | safe}};
                    Plotly.plot('averageSpendPie',pie,{});
                </script>
            </div>
            <div id='averageItemPie' class='chart g-col-6'style="width: 600px;">
                <script type='text/javascript'>
                    var pie = {{averageItemPie | safe}};
                    Plotly.plot('averageItemPie',pie,{});
                </script>
            </div>
        </div>
        
    </div>
    <div class="container">
        <input type="number" id="hshdNumSearch" placeholder="Enter Hshd Num">
    <button onclick="search()">Search</button>
        <table id="detailedTable" class="table table-striped">
            <thead>
                <tr>
                    <th>Household Number</th>
                    <th>Basket Number</th>
                    <th>Date</th>
                    <th>Product Number</th>
                    <th>Department</th>
                    <th>Commodity</th>
                    <th>Spend</th>
                    <th>Units</th>
                    <th>Store Region</th>
                    <th>Week</th>
                    <th>Year</th>
                    <th>L</th>
                    <th>Age Range</th>
                    <th>Marital</th>
                    <th>Income Range</th>
                    <th>Homeowner</th>
                    <th>Household Composition</th>
                    <th>Household Size</th>
                    <th>Children</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
    </table>
    </div>

    <script>
        $(document).ready(function() {
            // Function to update charts based on selected value
        function updateCharts(selectedValue) {
            $.ajax({
                url: '/dashboard/demo',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ selected_value: selectedValue, template: "dashboard.html"}),
                success: function(response) {
                    // Replace the charts in the container with the updated ones
                    
                },
                error: function(error) {
                    console.log('here')
                    console.error('Error:', error);
                }
            });
        }

        // Call the updateCharts function when dropdown value changes
        $('#demographicDDL').change(function() {
            var selectedValue = $(this).val();
            updateCharts(selectedValue);
        });
        });
    </script>
    
    <!--
    <script>
        function search() {
            var hshd = document.getElementById('hshdNumSearch').value;
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                        document.getElementById('tableContainer').innerHTML = xhr.responseText;
                    } else {
                        console.error('Request failed:', xhr.status);
                    }
                }
            }
            xhr.open('GET', '/dashboard/table/search?term=' + encodeURIComponent(hshd), true);
            xhr.send();
        }
    </script>-->
</div>


    
{% endblock %}

{% block scripts %}
  <script>
    $(document).ready(function () {
      $('#detailedTable').DataTable({
        ajax: '/dasboard/table/data',
        columns: [
          {data: 'HSHD_NUM', orderable: true, searchable: true},
          {data: 'BASKET_NUM', orderable: true, searchable: false},
          {data: 'DATE', orderable: true, searchable: false},
          {data: 'PRODUCT_NUM', orderable: true, searchable: false},
          {data: 'DEPARTMENT', orderable: true, searchable: false},
          {data: 'COMMODITY', orderable: true, searchable: false},
          {data: 'SPEND', orderable: false, searchable: false},
          {data: 'UNITS', orderable: false, searchable: false},
          {data: 'STORE_R', orderable: false, searchable: false},
          {data: 'WEEK_NUM', orderable: false, searchable: false},
          {data: 'YEAR', orderable: false, searchable: false},
          {data: 'L', orderable: false, searchable: false},
          {data: 'AGE_RANGE', orderable: false, searchable: false},
          {data: 'MARITAL', orderable: false, searchable: false},
          {data: 'INCOME_RANGE', orderable: false, searchable: false},
          {data: 'HOMEOWNER', orderable: false, searchable: false},
          {data: 'HSHD_COMPOSITION', orderable: false, searchable: false},
          {data: 'HH_SIZE', orderable: false, searchable: false},
          {data: 'CHILDREN', orderable: false, searchable: false}
        ],
      });
    });
  </script>
{% endblock %}